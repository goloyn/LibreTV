<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>LibreTV Player</title>
  <link rel="stylesheet" href="css/tailwind.css" />
</head>
<body class="bg-black">

<div id="video-container" class="relative">
  <video id="video-player" class="w-full max-h-screen" controls></video>

  <!-- 跳过按钮 -->
  <div id="btnSkipIntro" class="absolute top-4 right-4 text-white bg-gray-800 p-2 rounded cursor-pointer z-50">跳过片头</div>
  <div id="btnSkipOutro" class="absolute top-12 right-4 text-white bg-gray-800 p-2 rounded cursor-pointer z-50">跳过片尾</div>
</div>

<script>
(function () {
  const video = document.getElementById("video-player");

  // 从 url query 获取视频地址
  const params = new URLSearchParams(window.location.search);
  const videoUrl = params.get("url") || "";
  video.src = videoUrl;

  // 用视频链接作为唯一 key (也可以改成剧集ID)
  const videoKey = 'skip_data_' + encodeURIComponent(videoUrl);

  // 加载 localStorage 存储的片头片尾数据
  let skipData = JSON.parse(localStorage.getItem(videoKey) || "{}");

  // 自动跳过片头
  video.addEventListener("loadedmetadata", () => {
    if (skipData.introEnd) {
      video.currentTime = skipData.introEnd;
    }
  });

  // 自动跳过片尾（播放到片尾点自动结束）
  video.addEventListener("timeupdate", () => {
    if (skipData.outroStart && video.currentTime >= skipData.outroStart) {
      video.pause();
      // 你也可以改成：跳下一集
    }
  });

  // 记录片头按钮
  document.getElementById("btnSkipIntro").onclick = () => {
    const t = video.currentTime;
    const d = video.duration;
    if (t < d / 2) {
      skipData.introEnd = t;
      localStorage.setItem(videoKey, JSON.stringify(skipData));
      alert('片头结束时间已记录：' + Math.floor(t) + 's');
    } else {
      alert('请在视频前半段点击记录片头结束！');
    }
  };

  // 记录片尾按钮
  document.getElementById("btnSkipOutro").onclick = () => {
    const t = video.currentTime;
    const d = video.duration;
    if (t >= d / 2) {
      skipData.outroStart = t;
      localStorage.setItem(videoKey, JSON.stringify(skipData));
      alert('片尾开始时间已记录：' + Math.floor(t) + 's');
    } else {
      alert('请在视频后半段点击记录片尾开始！');
    }
  };
})();
</script>

</body>
</html>
